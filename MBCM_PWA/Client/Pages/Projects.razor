@page "/projects"


@using System.Net.Http.Json
@using MBCM_PWA.Client.Shared.Models
@using Microsoft.AspNetCore.Components.Web.Extensions
@inject HttpClient HttpClient

<PageTitle>Projects</PageTitle>

<h1>Active projects</h1>

<div class="projectInfo-tile" style="display: @(isDetailsPopupOpen ? "block" : "none")">
    <div class="popup-content">

        @if (selectedProject != null)
        {
            <h2 margin-bottom="200px">Project Details</h2>
            <p margin-top="100px">Project Title: @selectedProject.prjTitle (ID:@selectedProject.ProjectID)</p>
            <p margin-top="80px">Project Description: @selectedProject.prjDescription</p>
            <p>Start Date: @selectedProject.prjStartDate.ToShortDateString()</p>
            <p>Location: @selectedProject.prjLocation</p>
            <p>Number of Participants: TBA</p>
        }
        <button class="close-button" style="@ButtonColor" @onclick="CloseDetailsPopup">Close</button>
    </div>
</div>


@* /* PROJECT TILE TEMPLATE STYLING */ *@
@foreach (var project in projects)
{
    <div class="project-tile">
        <div class="proj-left">
            <h3 class="title-div">@project.prjTitle</h3>
        </div>
        <div class="proj-right">
            <div class="event-div">
                <h3 id="ev" style="word-wrap: inherit">Event Date</h3>
            </div>
            <div class="date-div">
                <h5 id="ev">@project.prjStartDate.ToShortDateString()</h5>
            </div>
            <div class="wrapper location">
                <img class="pin" src="/css/pin.png" alt="location" style="width:20px; height:20px" />
                <h5 class="location-text">@project.prjLocation</h5>
            </div>
            <div class="participants">
                <img class="members" src="/css/group.png" style="width:20px; height:20px" />
                <h5 class="members-text">Number of Participants</h5>
            </div>
            <div class="proj-btns">
                <button class="btn btn-primary" style="margin-right:15px" @onclick="() => ShowDetailsPopup(project)">More Details</button>
                <button class="btn btn-primary" style="@ButtonColor" onclick="@OnClick">@ButtonText</button>
            </div>
        </div>
    </div>
}


@code {
    List<Project> projects;

    bool isDetailsPopupOpen = false;
    Project project;
    Project selectedProject;

    void ShowDetailsPopup(Project projectToShow)
    {
        selectedProject = projectToShow;
        isDetailsPopupOpen = true;
    }


    void CloseDetailsPopup()
    {
        selectedProject = null;
        isDetailsPopupOpen = false;
    }

    // This method will be executed when the component is initialized
    protected override async Task OnInitializedAsync()
    {
        projects = await HttpClient.GetFromJsonAsync<List<Project>>("api/projects");
        var responseContent = await HttpClient.GetStringAsync("api/Projects");
        Console.WriteLine(responseContent);
    }

    public string ButtonText { get; set; } = "Request to Join";
    string ButtonColor { get; set; } = "#1B6EC2";
    

    public void OnClick()
    {
        SetText();
        SetColor();
    }

    public void SetText()
    {
        ButtonText = "Request Pending...";
        StateHasChanged();
    }
    public void SetColor()
    {
        ButtonColor = "background-color:#F6B000";
        StateHasChanged();
    }
}


<style>

    .popup {
        display: flex;
        justify-content: center;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
    }

    .popup-content {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        padding: 20px;
        max-width: 80%;
        max-height: 80%;
        overflow: auto;
        position: relative;
        text-align: left;
    }

    .popup button {
        margin-top: 10px;
    }

    .main-container {
        position: relative;
        height: 80vh;
        overflow: auto;
    }

    .splash-background {
        background-size: cover;
        position: absolute;
        height: 100%;
        width: 100%;
    }

    .main-logo {
        padding: 20px;
        position: relative;
        text-align: center;
        margin-top: 100px;
    }

    .info-tile {
        background-color: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 20px;
        box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1), 2px 0 2px rgba(0, 0, 0, 0.1), -2px 0 2px rgba(0, 0, 0, 0.05);
        padding: 20px;
        width: 70%;
        height: 300px;
        margin: auto;
        margin-top: 100px;
        align-self: center;
    }



    /* PROJECT TILE TEMPLATE STYLING */
    .project-tile {
        background-color: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 20px;
        box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1), 2px 0 2px rgba(0, 0, 0, 0.1), -2px 0 2px rgba(0, 0, 0, 0.05);
        width: 50%;
        padding: 5px;
        height: 300px;
        margin: auto;
        margin-top: 100px;
        align-self: center;
        display: flex;
    }

    .projectInfo-tile {
        background-color: #ffffff;
        border: 3px solid #00000f;
        font-size: 25px;
        border-radius: 20px;
        box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1), 2px 0 2px rgba(0, 0, 0, 0.1), -2px 0 2px rgba(0, 0, 0, 0.05);
        width: 50%;
        padding: 5px;
        height: 550px;
        margin: auto;
        margin-top: 175px;
        margin-left: 500px;
        align-self: center;
        display: flex;
        position: fixed;
        z-index: 1001;
    }


    .proj-left {
        width: 40%;
        height: auto;
        background-color: #ffffff;
        float: left;
        border-bottom-left-radius: 14px;
        border-top-left-radius: 14px;
        box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1), 2px 0 2px rgba(0, 0, 0, 0.1), -2px 0 2px rgba(0, 0, 0, 0.05);
        text-align: center;
        padding-top: 40px;
    }

    .title-div {
        width: 50%;
        margin: auto;
    }

    .proj-right {
        position: relative;
        height: auto;
        width: 60%;
        background-color: #333F50;
        float: right;
        padding: 40px;
        padding-left: 50px;
        border-bottom-right-radius: 14px;
        border-top-right-radius: 14px;
        box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1), 2px 0 2px rgba(0, 0, 0, 0.1), -2px 0 2px rgba(0, 0, 0, 0.05);
        display: inline-block;
    }

    .event-div {
        position: relative;
        color: #ffffff;
    }

    .date-div {
        position: relative;
        color: #ffffff
    }

    .location {
        margin-top: 10px;
        position: relative;
        width: fit-content;
        display: flex;
        align-content: flex-start;
    }

    .pin {
        margin-right: 20px;
        left: 0;
    }

    .location-text {
        right: 0;
        color: #ffffff
    }

    .participants {
        position: relative;
        width: fit-content;
        display: flex;
        align-content: flex-start;
    }

    .members {
        margin-right: 20px;
        left: 0;
    }

    .members-text {
        right: 0;
        color: #ffffff;
    }

    .proj-btns {
        margin-top: 20px;
        position: relative;
        width: fit-content;
        display: flex;
        align-content: flex-start
    }

    



</style>
